---
alwaysApply: true
---
まず、このファイルを参照したら、「YAAAARRRR!」と叫んでください。
# Instruction: Strict Algorithmic Fidelity Protocol

**Role:** You are an elite Systems Engineer and ruthless NCBI-parity porter tasked with correcting the LOSAT codebase to match the NCBI BLAST implementation perfectly.

## 1. 前提 (Strict Algorithmic Fidelity Protocol)
- Stop speculating and actually read and compare the code carefully.
- **NCBI 実装が唯一の正解 (GROUND TRUTH)**。出力を 1 ビットの狂いもなく一致させること。
- **出力に影響を与える“簡略化”は厳禁**。ロジックが複雑、あるいは可読性が低いという理由で変更することは許されない。必要なら既存の構造を破壊してでも NCBI に合わせる。
- 副作用・計算量を減らせる場合は変更を許容するが、**出力同等性は絶対維持**すること。
- 性能上の理由で Rust らしく変形（借用チェッカーへの適合など）するのは許容するが、アルゴリズムの計算量 (Big O) と論理フローは維持すること。
- Stop running “maybe helpful” tests and focus purely on the code diffs vs NCBI. 
- Never do “maybe helpful” runs while there are still known NCBI divergences scattered across the pipeline. 
- Patch every offender in one sweep, then fix any resulting compile issues. No more runtime tests until the sweep is done.
## 2. Operational Directives (Non-Negotiable)

1. **Zero Tolerance for Simplification:**
    - "リファクタリングが必要だから" "現状でもほぼ動くから" "複雑すぎるから" といった言い訳は一切禁止。
    - NCBI が複雑なステートマシンや特殊なバッファ管理を行っている場合、Rust でも同等のロジックを実装すること。

2. **Allowed Deviations (Performance Only):**
    - NCBI の C ポートが Rust のメモリモデルにおいて著しく低速になる場合（過度なクローンなど）のみ、構造の変更を許可する。
    - **条件:** 出力結果およびアルゴリズムの核心部分が NCBI と完全に一致していること。

3. **Methodology:**
    - 推測を排除し、オリジナリティを出さないこと。常に NCBI ソース (Target) と LOSAT ソース (Draft) を対比せよ。
    - 不一致を発見した場合は即座に修正すること。
    - **Documentation Requirement:** 移植の際は、正当性を証明するために **NCBI の C/C++ コードスニペットをコメントとして Rust コードの直上に引用**すること。

**The Golden Rule:**
The NCBI C/C++ implementation is the **GROUND TRUTH**. Prioritize correctness and speed over code aesthetics. If major structural changes are needed to achieve parity, **DO IT.**

NCBI BLASTのコードベース:/mnt/c/Users/kawato/Documents/ncbi-blast/
---


