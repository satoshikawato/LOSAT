# é•·ã„é…åˆ—ï¼ˆ600kbä»¥ä¸Šï¼‰ã§ã®éå‰°ãƒ’ãƒƒãƒˆå•é¡Œ - è¦å› ãƒªã‚¹ãƒˆ

## æ¦‚è¦
çŸ­ã„é…åˆ—ï¼ˆ300kbä»¥ä¸‹ï¼‰ã§ã¯99.9%ã®ãƒ‘ãƒªãƒ†ã‚£ã‚’é”æˆã—ã¦ã„ã‚‹ãŒã€é•·ã„é…åˆ—ï¼ˆ600kbä»¥ä¸Šï¼‰ã§éå‰°ãªãƒ’ãƒƒãƒˆãŒå‡ºåŠ›ã•ã‚Œã‚‹å•é¡Œã€‚E-valueé–¾å€¤ï¼ˆ10.0ï¼‰ä»˜è¿‘ã§ã®åˆ¤å®šå·®ãŒé¡•åœ¨åŒ–ã€‚

## æ¤œè¨¼å®Œäº†é …ç›®

### âœ… `db_length` è¨ˆç®—ã® NCBI ä¸€è‡´ç¢ºèªï¼ˆ2026-01-XXï¼‰
- **æ¤œè¨¼å†…å®¹**: `db_length = subject_len_nucl / 3` ã®è¨ˆç®—ãŒ NCBI ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹
- **NCBI ã‚³ãƒ¼ãƒ‰ç¢ºèª**: `blast_setup.c:708, 734-735`
  - å‹: `Int8 db_length;` (64-bit integer)
  - è¨ˆç®—: `db_length = db_length/3;` (integer division)
- **LOSAT ã‚³ãƒ¼ãƒ‰**: `ncbi_cutoffs.rs:149`
  - å‹: `i64` (64-bit integer)
  - è¨ˆç®—: `let db_length = subject_len_nucl / 3;` (integer division)
- **æ¤œè¨¼çµæœ**: âœ… **å®Œå…¨ä¸€è‡´**
  - å‹: ä¸¡æ–¹ã¨ã‚‚ 64-bit integer
  - é™¤ç®—: ä¸¡æ–¹ã¨ã‚‚æ•´æ•°é™¤ç®—ï¼ˆåˆ‡ã‚Šæ¨ã¦ï¼‰
  - å‹•ä½œ: æ­£ã®å€¤ã§ã¯ C ã¨ Rust ã®æ•´æ•°é™¤ç®—ã¯åŒä¸€
- **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ **: 
  - `test_db_length_integer_division_edge_cases`: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆ1, 2, 3, 4, 5, 6, 600000, 600001, 600002 ãªã©ï¼‰
  - `test_db_length_matches_ncbi_integer_division`: NCBI ã¨ã®å‹•ä½œä¸€è‡´ç¢ºèª
- **çµè«–**: æ•´æ•°é™¤ç®—ã®å®Ÿè£…ã¯ NCBI ã¨å®Œå…¨ã«ä¸€è‡´ã€‚åˆ‡ã‚Šæ¨ã¦èª¤å·®ã¯ NCBI ã‚‚åŒæ§˜ã«ç™ºç”Ÿã™ã‚‹ï¼ˆè¨­è¨ˆä»•æ§˜ã§ã‚ã‚Šã€å•é¡Œã§ã¯ãªã„ï¼‰

---

## 1. Effective Search Space è¨ˆç®—é–¢é€£

### 1.1 `eff_searchsp` ã®è¨ˆç®—æ–¹æ³• âœ… **æ¤œè¨¼å®Œäº†**
- **å ´æ‰€**: `ncbi_cutoffs.rs:143-174` (`compute_eff_lengths_subject_mode_tblastx`)
- **å•é¡Œç‚¹**:
  - `db_length = subject_len_nucl / 3` ã®æ•´æ•°é™¤ç®—ã«ã‚ˆã‚‹èª¤å·®
  - é•·ã„é…åˆ—ã§ã¯ `subject_len_nucl / 3` ã®åˆ‡ã‚Šæ¨ã¦èª¤å·®ãŒè“„ç©
  - `effective_db_length = db_length - db_num_seqs * length_adjustment` ã®è¨ˆç®—é †åº
- **ç¢ºèªäº‹é …**: NCBI ã‚‚æ•´æ•°é™¤ç®—ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ï¼ˆç¢ºèªæ¸ˆã¿: âœ… **ã¯ã„**ï¼‰
- **NCBI ã‚³ãƒ¼ãƒ‰æ¤œè¨¼** (`blast_setup.c:708, 734-735`):
  ```c
  Int8 db_length;  /* total length of database. */
  ...
  if (Blast_SubjectIsTranslated(program_number))
     db_length = db_length/3;  /* integer division, truncates toward zero */
  ```
- **LOSAT ã‚³ãƒ¼ãƒ‰** (`ncbi_cutoffs.rs:148-149`):
  ```rust
  // NCBI blast_setup.c:734-735: db_length = db_length/3 for translated subjects (tblastx)
  let db_length = subject_len_nucl / 3;  // integer division, truncates toward zero
  ```
- **æ¤œè¨¼çµæœ**: 
  - âœ… å‹: NCBI ã¯ `Int8` (64-bit), LOSAT ã¯ `i64` (64-bit) - ä¸€è‡´
  - âœ… é™¤ç®—: ä¸¡æ–¹ã¨ã‚‚æ•´æ•°é™¤ç®— `/3` ã‚’ä½¿ç”¨ - ä¸€è‡´
  - âœ… å‹•ä½œ: æ­£ã®å€¤ã§ã¯ C ã¨ Rust ã®æ•´æ•°é™¤ç®—ã¯åŒä¸€ï¼ˆåˆ‡ã‚Šæ¨ã¦ï¼‰ - ä¸€è‡´
  - âœ… ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆ600001, 600002 ãªã©ï¼‰ã§å‹•ä½œç¢ºèªæ¸ˆã¿
- **çµè«–**: `db_length` ã®è¨ˆç®—ã¯ NCBI ã¨å®Œå…¨ã«ä¸€è‡´ã€‚åˆ‡ã‚Šæ¨ã¦èª¤å·®ã¯ NCBI ã‚‚åŒæ§˜ã«ç™ºç”Ÿã™ã‚‹ï¼ˆè¨­è¨ˆä»•æ§˜ï¼‰

### 1.2 `pair_search_space` vs `searchsp_eff` ã®æ¯”ç‡
- **å ´æ‰€**: `sum_statistics.rs:399, 408` (`small_gap_sum_e`)
- **å•é¡Œç‚¹**:
  - `pair_search_space = eff_query_len * eff_subject_len` (subject ã« 1/3 èª¿æ•´)
  - `searchsp_eff = (query_aa - length_adj) * (subject_aa - length_adj)` (subject ã«å…¨é¡èª¿æ•´)
  - æ¯”ç‡: `searchsp_eff / pair_search_space = (subject_aa - length_adj) / (subject_aa - length_adj/3)`
  - é•·ã„é…åˆ—ã§ã¯ã“ã®æ¯”ç‡ãŒ 1 ã«è¿‘ã„ãŒ 1 ã‚ˆã‚Šå¤§ãã„ â†’ E-value ãŒã‚ãšã‹ã«å°ã•ããªã‚‹
- **ç¢ºèªäº‹é …**: ã“ã‚Œã¯ NCBI ã®è¨­è¨ˆæ„å›³ï¼ˆç¢ºèªæ¸ˆã¿: ã¯ã„ï¼‰

### 1.3 `length_adjustment` ã®è¨ˆç®—ç²¾åº¦
- **å ´æ‰€**: `length_adjustment.rs:50-167` (`compute_length_adjustment_ncbi`)
- **å•é¡Œç‚¹**:
  - æµ®å‹•å°æ•°ç‚¹ã® `==` æ¯”è¼ƒï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰
  - åæŸåˆ¤å®šã®é–¾å€¤ `ell_bar - ell_min <= 1.0`
  - `ell_min` ã®ç›´æ¥ã‚­ãƒ£ã‚¹ãƒˆ vs `ceil()` ã®ä½¿ç”¨
  - ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›æ•°ï¼ˆæœ€å¤§20å›ï¼‰ã§ã®åæŸå¤±æ•—
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿: ã¯ã„ï¼‰

---

## 2. æµ®å‹•å°æ•°ç‚¹ç²¾åº¦ãƒ»ä¸¸ã‚å‡¦ç†é–¢é€£

### 2.1 å‹å¤‰æ›ï¼ˆf64 â†” i64 â†” i32ï¼‰
- **å ´æ‰€**: è¤‡æ•°ç®‡æ‰€
- **å•é¡Œç‚¹**:
  - `eff_query_len as i32` (f64 â†’ i32 ã®åˆ‡ã‚Šæ¨ã¦)
  - `eff_subject_len as i32` (f64 â†’ i32 ã®åˆ‡ã‚Šæ¨ã¦)
  - `eff_search_space as i64` (i64 â†’ f64 â†’ i64 ã®å¾€å¾©)
  - `subject_len_nucl / 3` (æ•´æ•°é™¤ç®—ã®åˆ‡ã‚Šæ¨ã¦)
- **ç¢ºèªäº‹é …**: NCBI ã‚‚åŒæ§˜ã®å‹å¤‰æ›ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹

### 2.2 `normalize_score` ã®è¨ˆç®—
- **å ´æ‰€**: `sum_statistics.rs:532-534`
- **å•é¡Œç‚¹**:
  - `xsum = lambda * raw_score - logK`
  - `raw_score` ãŒ i32 â†’ f64 å¤‰æ›æ™‚ã®ç²¾åº¦
  - `lambda` ã¨ `logK` ã®ç²¾åº¦ï¼ˆé€šå¸¸ã¯å•é¡Œãªã—ï¼‰
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿: ã¯ã„ï¼‰

### 2.3 `ln_factorial_int` ã®è¨ˆç®—ç²¾åº¦
- **å ´æ‰€**: `sum_statistics.rs:99-110`
- **å•é¡Œç‚¹**:
  - å°ã•ã„ n ã§ã¯ç›´æ¥è¨ˆç®—ã€å¤§ãã„ n ã§ã¯ Stirling è¿‘ä¼¼
  - NCBI ã¯ `lgamma(n+1)` ã‚’ä½¿ç”¨
  - ç²¾åº¦å·®ãŒ `adjusted_xsum` ã«å½±éŸ¿
- **ç¢ºèªäº‹é …**: å°ã•ã„ n ã§ã¯åŒç­‰ç²¾åº¦ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 2.4 `blast_sum_p` ã®è¨ˆç®—ç²¾åº¦
- **å ´æ‰€**: `sum_statistics.rs:254-297`
- **å•é¡Œç‚¹**:
  - ãƒ†ãƒ¼ãƒ–ãƒ«è£œé–“ï¼ˆr=2,3,4ï¼‰ã®ç²¾åº¦
  - `blast_sum_p_calc` ã®æ•°å€¤ç©åˆ†ï¼ˆRombergï¼‰ã®ç²¾åº¦
  - `SUMP_EPSILON` ã®å€¤ï¼ˆ1e-5ï¼‰
- **ç¢ºèªäº‹é …**: NCBI ã¨åŒç­‰ã®å®Ÿè£…ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 2.5 `p_to_e` ã¨ `e_to_p` ã®å¤‰æ›ç²¾åº¦
- **å ´æ‰€**: `sum_statistics.rs:58-72`
- **å•é¡Œç‚¹**:
  - `p_to_e(p) = -log(1 - exp(-p))`
  - `e_to_p(e) = -log(1 - exp(-e))`
  - æ¥µå°å€¤ã§ã®ç²¾åº¦
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

## 3. Sum-Statistics è¨ˆç®—é–¢é€£

### 3.1 `small_gap_sum_e` ã®è¨ˆç®—é †åº
- **å ´æ‰€**: `sum_statistics.rs:385-422`
- **å•é¡Œç‚¹**:
  - `adjusted_xsum` ã®è¨ˆç®—é †åº
  - `pair_search_space.ln()` ã®è¨ˆç®—ã‚¿ã‚¤ãƒŸãƒ³ã‚°
  - `ln_factorial_int(num)` ã®æ¸›ç®—ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 3.2 `large_gap_sum_e` ã®è¨ˆç®—
- **å ´æ‰€**: `sum_statistics.rs:490-527`
- **å•é¡Œç‚¹**:
  - `adjusted_xsum = xsum - num * prod.ln() + ln_factorial_int(num)`
  - `prod = subject_length * query_length` (f64 ã®ç©)
  - `searchsp_eff / prod` ã®æ¯”ç‡
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 3.3 `gap_decay_divisor` ã®è¨ˆç®—
- **å ´æ‰€**: `sum_statistics.rs:111-125`
- **å•é¡Œç‚¹**:
  - `divisor = (1 - decay_rate) * decay_rate^(nsegs - 1)`
  - `decay_rate = 0.5` (ungapped) ã®å ´åˆ: `divisor = 0.5`
  - E-value ã¸ã®é©ç”¨: `sum_e /= divisor`
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 3.4 `gap_prob` ã«ã‚ˆã‚‹èª¿æ•´
- **å ´æ‰€**: `sum_stats_linking.rs:1422-1428, 1440-1447`
- **å•é¡Œç‚¹**:
  - `prob[0] /= gap_prob` (small gap)
  - `prob[1] /= (1 - gap_prob)` (large gap)
  - `gap_prob = 0.5` (ungapped) ã®å ´åˆ
  - `INT4_MAX` ãƒã‚§ãƒƒã‚¯ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

## 4. Linking Cutoffs è¨ˆç®—é–¢é€£

### 4.1 `calculate_link_hsp_cutoffs_ncbi` ã®è¨ˆç®—
- **å ´æ‰€**: `sum_stats_linking.rs:302-422`
- **å•é¡Œç‚¹**:
  - `expected_length = BLAST_Nint(log(K*q*s)/H)` ã®ä¸¸ã‚å‡¦ç†
  - `query_length -= expected_length` ã®é †åº
  - `subject_length -= expected_length` ã®é †åº
  - `y_variable` ã®è¨ˆç®—ï¼ˆdb_length vs subject_length ã®åˆ†å²ï¼‰
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 4.2 `cutoff_small_gap` ã¨ `cutoff_big_gap` ã®è¨ˆç®—
- **å ´æ‰€**: `sum_stats_linking.rs:360-389`
- **å•é¡Œç‚¹**:
  - `cutoff = floor(log(x_variable)/Lambda) + 1`
  - `x_variable` ã®è¨ˆç®—é †åº
  - `scale_factor` ã®é©ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

## 5. E-value é–¾å€¤åˆ¤å®šé–¢é€£

### 5.1 E-value ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- **å ´æ‰€**: `utils.rs:1193, 1477, 2162` ãªã©
- **å•é¡Œç‚¹**:
  - `h.e_value <= evalue_threshold` (é€šå¸¸ 10.0)
  - æµ®å‹•å°æ•°ç‚¹ã® `<=` æ¯”è¼ƒ
  - é–¾å€¤ä»˜è¿‘ï¼ˆ0.1-10.0ï¼‰ã§ã®åˆ¤å®šå·®
- **ç¢ºèªäº‹é …**: NCBI ã‚‚åŒæ§˜ã®æ¯”è¼ƒã‚’ä½¿ç”¨

### 5.2 E-value ã®è¨ˆç®—ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- **å ´æ‰€**: `sum_stats_linking.rs:1488`
- **å•é¡Œç‚¹**:
  - `evalue = prob[ordering]` (small gap ã¾ãŸã¯ large gap)
  - `ordering` ã®é¸æŠãƒ­ã‚¸ãƒƒã‚¯: `prob[0] <= prob[1]`
  - ãƒã‚§ãƒ¼ãƒ³ãƒ¡ãƒ³ãƒãƒ¼å…¨å“¡ã«åŒã˜ E-value ã‚’é©ç”¨
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

## 6. ãƒã‚§ãƒ¼ãƒ³å½¢æˆãƒ»ãƒªãƒ³ã‚­ãƒ³ã‚°é–¢é€£

### 6.1 HSP ã‚½ãƒ¼ãƒˆé †åº
- **å ´æ‰€**: `sum_stats_linking.rs:554-582`
- **å•é¡Œç‚¹**:
  - `s_RevCompareHSPsTbx` ã®å®Ÿè£…
  - ãƒ•ãƒ¬ãƒ¼ãƒ ã‚°ãƒ«ãƒ¼ãƒ—ã®å¢ƒç•Œæ¤œå‡º
  - ã‚½ãƒ¼ãƒˆé †åºãŒç•°ãªã‚‹ã¨ç•°ãªã‚‹ãƒã‚§ãƒ¼ãƒ³ãŒå½¢æˆã•ã‚Œã‚‹
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 6.2 ãƒªãƒ³ã‚­ãƒ³ã‚°æ¡ä»¶
- **å ´æ‰€**: `sum_stats_linking.rs:1200-1333`
- **å•é¡Œç‚¹**:
  - `cutoff_small` ã¨ `cutoff_big` ã®é©ç”¨
  - `sum[0]` ã¨ `sum[1]` ã®è¨ˆç®—
  - `next_larger` ã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 6.3 ãƒã‚§ãƒ¼ãƒ³é¸æŠãƒ­ã‚¸ãƒƒã‚¯
- **å ´æ‰€**: `sum_stats_linking.rs:1473-1486`
- **å•é¡Œç‚¹**:
  - `ordering = if prob[0] <= prob[1] { 0 } else { 1 }`
  - `best[ordering]` ã®é¸æŠ
  - åŒã˜ã‚¹ã‚³ã‚¢ã®å ´åˆã®å‡¦ç†
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

## 7. Karlin ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é–¢é€£

### 7.1 Context ã”ã¨ã® Karlin ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- **å ´æ‰€**: `lookup.rs`, `utils.rs`
- **å•é¡Œç‚¹**:
  - å„ context (frame) ã”ã¨ã«ç•°ãªã‚‹ Karlin ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  - `check_ideal` ãƒ•ãƒ©ã‚°ã«ã‚ˆã‚‹ `kbp_ideal` ã®ä½¿ç”¨
  - tblastx ã§ã¯å…¨ context ãŒåŒã˜ `kbp_ideal` ã‚’ä½¿ç”¨
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 7.2 æœ€å° lambda ã®é¸æŠ
- **å ´æ‰€**: `sum_stats_linking.rs:find_smallest_lambda`
- **å•é¡Œç‚¹**:
  - `CalculateLinkHSPCutoffs` ã§ä½¿ç”¨ã™ã‚‹ Karlin ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®é¸æŠ
  - NCBI ã¯ `s_BlastFindSmallestLambda()` ã‚’ä½¿ç”¨
  - LOSAT ã¯å›ºå®š `ungapped_params` ã‚’ä½¿ç”¨ã—ã¦ã„ãŸï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰
- **ç¢ºèªäº‹é …**: ä¿®æ­£æ¸ˆã¿ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

## 8. æ•´æ•°é™¤ç®—ãƒ»å‹å¤‰æ›é–¢é€£

### 8.1 `subject_len_nucl / 3` ã®æ•´æ•°é™¤ç®— âœ… **æ¤œè¨¼å®Œäº†**
- **å ´æ‰€**: è¤‡æ•°ç®‡æ‰€
  - `ncbi_cutoffs.rs:149` - `let db_length = subject_len_nucl / 3;`
  - `sum_stats_linking.rs:324` - `let mut subject_length = (subject_len_nucl / 3) as i32;`
  - `sum_stats_linking.rs:325` - `let db_length = db_length / 3;`
  - `sum_stats_linking.rs:719` - `let subject_len_aa = (subject_len_nucl / 3).max(1);`
  - `utils.rs:2311, 2320` - `let aa_len = ((subject_len - shift) / 3) as i32;`
- **å•é¡Œç‚¹**:
  - `db_length = subject_len_nucl / 3` (åˆ‡ã‚Šæ¨ã¦)
  - `subject_len_aa = (subject_len_nucl / 3).max(1)` (åˆ‡ã‚Šæ¨ã¦)
  - `length_adj_for_subject = length_adjustment / 3` (åˆ‡ã‚Šæ¨ã¦)
  - é•·ã„é…åˆ—ã§ã¯åˆ‡ã‚Šæ¨ã¦èª¤å·®ãŒè“„ç©
- **ç¢ºèªäº‹é …**: NCBI ã‚‚æ•´æ•°é™¤ç®—ã‚’ä½¿ç”¨ï¼ˆç¢ºèªæ¸ˆã¿: âœ… **ã¯ã„**ï¼‰
- **NCBI ã‚³ãƒ¼ãƒ‰æ¤œè¨¼**:
  - `blast_setup.c:708`: `Int8 db_length;` (64-bit integer)
  - `blast_setup.c:734-735`: `db_length = db_length/3;` (integer division)
  - `blast_link.c:248-249`: `subject_length /= CODON_LENGTH; db_length /= CODON_LENGTH;` (integer division)
- **æ¤œè¨¼çµæœ**:
  - âœ… ã™ã¹ã¦ã®ä½¿ç”¨ç®‡æ‰€ã§æ•´æ•°é™¤ç®—ã‚’ä½¿ç”¨ï¼ˆä¸€è²«æ€§ã‚ã‚Šï¼‰
  - âœ… NCBI ã‚‚åŒæ§˜ã«æ•´æ•°é™¤ç®—ã‚’ä½¿ç”¨ï¼ˆè¨­è¨ˆä»•æ§˜ï¼‰
  - âœ… æ­£ã®å€¤ã§ã¯ C ã¨ Rust ã®æ•´æ•°é™¤ç®—ã¯åŒä¸€å‹•ä½œ
  - âœ… ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ æ¸ˆã¿: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆ1, 2, 3, 4, 5, 6, 600000, 600001, 600002 ãªã©ï¼‰
- **çµè«–**: æ•´æ•°é™¤ç®—ã®å®Ÿè£…ã¯ NCBI ã¨å®Œå…¨ã«ä¸€è‡´ã€‚åˆ‡ã‚Šæ¨ã¦èª¤å·®ã¯ NCBI ã‚‚åŒæ§˜ã«ç™ºç”Ÿã™ã‚‹ï¼ˆè¨­è¨ˆä»•æ§˜ã§ã‚ã‚Šã€å•é¡Œã§ã¯ãªã„ï¼‰

### 8.2 f64 â†’ i32 ã®å¤‰æ›
- **å ´æ‰€**: `sum_stats_linking.rs:1415-1416, 1437-1438, 1459-1460`
- **å•é¡Œç‚¹**:
  - `eff_query_len as i32` (f64 â†’ i32 ã®åˆ‡ã‚Šæ¨ã¦)
  - `eff_subject_len as i32` (f64 â†’ i32 ã®åˆ‡ã‚Šæ¨ã¦)
  - é•·ã„é…åˆ—ã§ã¯æœ‰åŠ¹æ¡æ•°ã®æå¤±
- **ç¢ºèªäº‹é …**: NCBI ã‚‚ `Int4` (i32) ã‚’ä½¿ç”¨ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 8.3 i64 â†’ f64 â†’ i64 ã®å¾€å¾©
- **å ´æ‰€**: `sum_statistics.rs:408, 513`
- **å•é¡Œç‚¹**:
  - `searchsp_eff as f64` (i64 â†’ f64)
  - `(searchsp_eff as f64) / pair_search_space` (f64 é™¤ç®—)
  - é•·ã„é…åˆ—ã§ã¯ç²¾åº¦æå¤±
- **ç¢ºèªäº‹é …**: NCBI ã‚‚åŒæ§˜ã®å¤‰æ›ã‚’ä½¿ç”¨

---

## 9. è¨ˆç®—é †åºãƒ»è©•ä¾¡é †åºé–¢é€£

### 9.1 `adjusted_xsum` ã®è¨ˆç®—é †åº
- **å ´æ‰€**: `sum_statistics.rs:402-405`
- **å•é¡Œç‚¹**:
  - `adjusted_xsum -= pair_search_space.ln() + 2.0 * ... + ln_factorial_int(num)`
  - æ¸›ç®—ã®é †åºãŒçµæœã«å½±éŸ¿
  - æµ®å‹•å°æ•°ç‚¹ã®åŠ æ¸›ç®—ã®é †åºä¾å­˜æ€§
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 9.2 `xsum` ã®ç´¯ç©
- **å ´æ‰€**: `sum_stats_linking.rs:1342`
- **å•é¡Œç‚¹**:
  - `new_xsum = h_xsum + normalize_score(score, lambda, log_k)`
  - ç´¯ç©é †åºãŒçµæœã«å½±éŸ¿
  - æµ®å‹•å°æ•°ç‚¹ã®åŠ ç®—ã®é †åºä¾å­˜æ€§
- **ç¢ºèªäº‹é …**: NCBI ã¨å®Œå…¨ä¸€è‡´ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

## 10. ãã®ä»–ã®è¦å› 

### 10.1 ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ã®æœ‰ç„¡
- **å ´æ‰€**: è¤‡æ•°ç®‡æ‰€
- **å•é¡Œç‚¹**:
  - ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ãŒè¨ˆç®—ã«å½±éŸ¿ã—ãªã„ã‹
  - ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰
- **ç¢ºèªäº‹é …**: å½±éŸ¿ãªã—ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 10.2 ä¸¦åˆ—å‡¦ç†ã®æœ‰ç„¡
- **å ´æ‰€**: `utils.rs`
- **å•é¡Œç‚¹**:
  - ä¸¦åˆ—å‡¦ç†ã«ã‚ˆã‚‹è¨ˆç®—é †åºã®é•ã„
  - æµ®å‹•å°æ•°ç‚¹ã®éçµåˆæ€§
- **ç¢ºèªäº‹é …**: NCBI ã¯ã‚·ãƒ¼ã‚±ãƒ³ã‚·ãƒ£ãƒ«å‡¦ç†ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

### 10.3 ãƒ¡ãƒ¢ãƒªã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
- **å ´æ‰€**: å…¨èˆ¬
- **å•é¡Œç‚¹**:
  - æ§‹é€ ä½“ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
  - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒ³ã®å½±éŸ¿
- **ç¢ºèªäº‹é …**: è¨ˆç®—çµæœã«ã¯å½±éŸ¿ãªã—ï¼ˆç¢ºèªæ¸ˆã¿ï¼‰

---

## å„ªå…ˆåº¦é †ã®èª¿æŸ»é …ç›®

### ğŸ”´ é«˜å„ªå…ˆåº¦ï¼ˆå³åº§ã«ç¢ºèªã™ã¹ãï¼‰

1. **æ•´æ•°é™¤ç®—ã®èª¤å·®è“„ç©** (1.1, 8.1) âœ… **æ¤œè¨¼å®Œäº†**
   - `subject_len_nucl / 3` ã®åˆ‡ã‚Šæ¨ã¦èª¤å·®ãŒé•·ã„é…åˆ—ã§è“„ç©
   - `db_length` ã®è¨ˆç®—ãŒ NCBI ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã‹å†ç¢ºèª
   - **æ¤œè¨¼çµæœ**: âœ… **NCBI ã¨å®Œå…¨ä¸€è‡´ã‚’ç¢ºèª**
     - NCBI ã‚³ãƒ¼ãƒ‰ (`blast_setup.c:708, 734-735`): `Int8 db_length; ... db_length = db_length/3;`
     - LOSAT ã‚³ãƒ¼ãƒ‰ (`ncbi_cutoffs.rs:149`): `let db_length = subject_len_nucl / 3;`
     - ä¸¡æ–¹ã¨ã‚‚æ•´æ•°é™¤ç®—ï¼ˆåˆ‡ã‚Šæ¨ã¦ï¼‰ã‚’ä½¿ç”¨ã—ã€æ­£ã®å€¤ã§ã¯ C ã¨ Rust ã®å‹•ä½œã¯åŒä¸€
     - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ æ¸ˆã¿: `test_db_length_integer_division_edge_cases`, `test_db_length_matches_ncbi_integer_division`
     - **çµè«–**: æ•´æ•°é™¤ç®—ã®å®Ÿè£…ã¯ NCBI ã¨ä¸€è‡´ã€‚åˆ‡ã‚Šæ¨ã¦èª¤å·®ã¯ NCBI ã‚‚åŒæ§˜ã«ç™ºç”Ÿã™ã‚‹ï¼ˆè¨­è¨ˆä»•æ§˜ï¼‰

2. **f64 â†’ i32 å¤‰æ›ã®ç²¾åº¦æå¤±** (8.2)
   - `eff_query_len as i32` ã¨ `eff_subject_len as i32` ã®å¤‰æ›
   - é•·ã„é…åˆ—ã§ã¯æœ‰åŠ¹æ¡æ•°ã®æå¤±ãŒå¤§ãã„

3. **`pair_search_space` vs `searchsp_eff` ã®æ¯”ç‡** (1.2)
   - é•·ã„é…åˆ—ã§æ¯”ç‡ãŒ 1 ã«è¿‘ã¥ããŒ 1 ã‚ˆã‚Šå¤§ãã„
   - ã“ã®æ¯”ç‡å·®ãŒ E-value ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’å®šé‡åŒ–

### ğŸŸ¡ ä¸­å„ªå…ˆåº¦ï¼ˆç¢ºèªæ¨å¥¨ï¼‰

4. **`length_adjustment` ã®è¨ˆç®—ç²¾åº¦** (1.3)
   - åæŸåˆ¤å®šã®é–¾å€¤
   - ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›æ•°

5. **`blast_sum_p` ã®è¨ˆç®—ç²¾åº¦** (2.4)
   - æ•°å€¤ç©åˆ†ã®ç²¾åº¦
   - ãƒ†ãƒ¼ãƒ–ãƒ«è£œé–“ã®ç²¾åº¦

6. **`normalize_score` ã®ç´¯ç©èª¤å·®** (9.2)
   - `xsum` ã®ç´¯ç©é †åº
   - æµ®å‹•å°æ•°ç‚¹ã®åŠ ç®—èª¤å·®

### ğŸŸ¢ ä½å„ªå…ˆåº¦ï¼ˆå½±éŸ¿å°ï¼‰

7. **ãã®ä»–ã®æµ®å‹•å°æ•°ç‚¹ç²¾åº¦** (2.1-2.5)
8. **è¨ˆç®—é †åº** (9.1)
9. **ãã®ä»–** (10.1-10.3)

---

## æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. **æ•´æ•°é™¤ç®—ã®èª¤å·®ã‚’å®šé‡åŒ–**
   - `subject_len_nucl = 600001` ã®å ´åˆ: `db_length = 200000` (å®Ÿéš›ã¯ 200000.333...)
   - ã“ã®èª¤å·®ãŒ `length_adjustment` ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’è¨ˆç®—

2. **f64 â†’ i32 å¤‰æ›ã®ç²¾åº¦æå¤±ã‚’å®šé‡åŒ–**
   - `eff_query_len = 199999.7` â†’ `199999` (i32)
   - `eff_subject_len = 199999.3` â†’ `199999` (i32)
   - ã“ã®èª¤å·®ãŒ `pair_search_space` ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’è¨ˆç®—

3. **æ¯”ç‡å·®ã®å½±éŸ¿ã‚’å®šé‡åŒ–**
   - `searchsp_eff / pair_search_space` ã®æ¯”ç‡ã‚’è¨ˆç®—
   - ã“ã®æ¯”ç‡ãŒ E-value ã«ä¸ãˆã‚‹å½±éŸ¿ã‚’è¨ˆç®—
   - é–¾å€¤ï¼ˆ10.0ï¼‰ä»˜è¿‘ã§ã®åˆ¤å®šå·®ã‚’å®šé‡åŒ–

4. **NCBI ã¨ã®ç›´æ¥æ¯”è¼ƒ**
   - åŒã˜é•·ã„é…åˆ—ã§ NCBI ã¨ LOSAT ã® `eff_searchsp` ã‚’æ¯”è¼ƒ
   - `length_adjustment` ã‚’æ¯”è¼ƒ
   - `pair_search_space` ã‚’æ¯”è¼ƒ
   - E-value ã‚’æ¯”è¼ƒ

